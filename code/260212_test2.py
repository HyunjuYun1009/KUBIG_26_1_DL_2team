# -*- coding: utf-8 -*-
"""260212_test2.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1Y9PJg38614yA_Z-1ZPJZJCKQaBl61vQ2
"""

import torch
print(f"í˜„ì¬ PyTorch: {torch.__version__}")
print(f"í˜„ì¬ CUDA: {torch.version.cuda}")

!pip install diffusers transformers accelerate

from google.colab import userdata
import os

# Colab Secretsì—ì„œ í† í° ë¶ˆëŸ¬ì˜¤ê¸°
os.environ['HF_TOKEN'] = userdata.get('HF_TOKEN')

# Hugging Face ë¡œê·¸ì¸
!huggingface-cli login --token $HF_TOKEN

# ë…¸ì…˜ í˜ì´ì§€ì˜ ì¹´í…Œê³ ë¦¬ â†’ QuickDraw ì‹¤ì œ ì´ë¦„
category_mapping = {
    # Tier 1: êµ¬ì²´ì  ê°œë…
    'water': 'cup',  # ë¬¼ â†’ ì»µ
    'toilet': 'toilet',  # í™”ì¥ì‹¤ âœ“

    # Tier 2: í†µì¦ í‘œí˜„
    'lightning': 'lightning',  # ë²ˆê°œ âœ“
    'knife': 'knife',  # ì¹¼ âœ“

    # Tier 3: ê°ì • í‘œí˜„
    'face': 'face',  # ì–¼êµ´ âœ“
    'cloud': 'cloud',  # êµ¬ë¦„ âœ“
    'heart': 'heart',  # í•˜íŠ¸ âœ“

    # ì¶”ê°€ (ë…¸ì…˜ì—ì„œ ì–¸ê¸‰ëœ ê²ƒë“¤)
    'storm': 'cloud',  # í­í’ â†’ êµ¬ë¦„ ì‚¬ìš©
    'broken_heart': 'heart',  # ê¹¨ì§„ í•˜íŠ¸ â†’ í•˜íŠ¸ ìˆ˜ì •
}

print("âœ… ì¹´í…Œê³ ë¦¬ ë§¤ì¹­ ì™„ë£Œ!")
for original, quickdraw in category_mapping.items():
    print(f"  {original:15s} â†’ {quickdraw}")

import requests
import json
from PIL import Image, ImageDraw

def download_quickdraw(category_name, num_samples=10):
    """
    QuickDrawì—ì„œ ì‹¤ì œ ìŠ¤ì¼€ì¹˜ ë‹¤ìš´ë¡œë“œ

    Args:
        category_name: QuickDraw ì¹´í…Œê³ ë¦¬ ì´ë¦„ (ìœ„ ë¦¬ìŠ¤íŠ¸ì—ì„œ)
        num_samples: ë‹¤ìš´ë¡œë“œí•  ìƒ˜í”Œ ìˆ˜
    """
    # URL ìƒì„± (ê³µë°±ì€ %20ìœ¼ë¡œ)
    url_name = category_name.replace(' ', '%20')
    url = f"https://storage.googleapis.com/quickdraw_dataset/full/simplified/{url_name}.ndjson"

    print(f"ğŸ“¥ ë‹¤ìš´ë¡œë“œ: {category_name}...", end=" ")

    try:
        # ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ (ë©”ëª¨ë¦¬ ì ˆì•½)
        response = requests.get(url, stream=True, timeout=30)
        response.raise_for_status()

        sketches = []
        lines_read = 0

        # ì¤„ ë‹¨ìœ„ë¡œ ì½ê¸°
        for line in response.iter_lines():
            if lines_read >= num_samples:
                break

            if line:
                try:
                    sketch_data = json.loads(line.decode('utf-8'))
                    sketches.append(sketch_data)
                    lines_read += 1
                except:
                    continue

        print(f"âœ… {len(sketches)}ì¥")
        return sketches

    except Exception as e:
        print(f"âŒ ì‹¤íŒ¨: {e}")
        return []

# í…ŒìŠ¤íŠ¸: cup ë‹¤ìš´ë¡œë“œ
test_sketches = download_quickdraw('cup', 3)

if test_sketches:
    print(f"\nìƒ˜í”Œ ë°ì´í„° êµ¬ì¡°:")
    print(f"  í‚¤: {test_sketches[0].keys()}")
    print(f"  ë‹¨ì–´: {test_sketches[0]['word']}")
    print(f"  ìŠ¤íŠ¸ë¡œí¬ ìˆ˜: {len(test_sketches[0]['drawing'])}")

# ì‹¤í—˜ì— í•„ìš”í•œ ì¹´í…Œê³ ë¦¬ (QuickDraw ì´ë¦„ìœ¼ë¡œ)
quickdraw_categories = {
    'tier1_concrete': ['cup', 'toilet'],
    'tier2_pain': ['lightning', 'knife'],
    'tier3_emotion': ['face', 'cloud', 'heart']
}

# ëª¨ë“  ì¹´í…Œê³ ë¦¬ ë‹¤ìš´ë¡œë“œ
all_sketches = {}

print("ğŸš€ QuickDraw ë‹¤ìš´ë¡œë“œ ì‹œì‘\n")
print("="*60)

for tier, categories in quickdraw_categories.items():
    print(f"\nğŸ“ {tier}")
    for cat in categories:
        sketches = download_quickdraw(cat, num_samples=10)
        if sketches:
            all_sketches[cat] = sketches

print("\n" + "="*60)
print(f"âœ… ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!")
print(f"   ì´ {len(all_sketches)}ê°œ ì¹´í…Œê³ ë¦¬")
print(f"   ì´ {sum(len(s) for s in all_sketches.values())}ì¥")
print("="*60)

# ì¹´í…Œê³ ë¦¬ í™•ì¸
for cat, data in all_sketches.items():
    print(f"  âœ“ {cat:15s}: {len(data)}ì¥")

def render_quickdraw_sketch(sketch_data, size=512):
    """
    QuickDraw JSONì„ ì´ë¯¸ì§€ë¡œ ë³€í™˜

    Args:
        sketch_data: dict (QuickDrawì˜ JSON ë°ì´í„°)
        size: int (ì¶œë ¥ ì´ë¯¸ì§€ í¬ê¸°)
    """
    img = Image.new('RGB', (size, size), 'white')
    draw = ImageDraw.Draw(img)

    drawing = sketch_data['drawing']

    # ëª¨ë“  ì¢Œí‘œì˜ ë²”ìœ„ ê³„ì‚°
    all_x = [x for stroke in drawing for x in stroke[0]]
    all_y = [y for stroke in drawing for y in stroke[1]]

    if not all_x or not all_y:
        return img

    min_x, max_x = min(all_x), max(all_x)
    min_y, max_y = min(all_y), max(all_y)

    # ì •ê·œí™” í•¨ìˆ˜ (íŒ¨ë”© í¬í•¨)
    def normalize(val, min_val, max_val, target_size):
        if max_val == min_val:
            return target_size // 2
        padding = 30
        normalized = (val - min_val) / (max_val - min_val)
        return int(padding + normalized * (target_size - 2*padding))

    # ê° ìŠ¤íŠ¸ë¡œí¬ ê·¸ë¦¬ê¸°
    for stroke in drawing:
        x_coords = stroke[0]
        y_coords = stroke[1]

        for i in range(len(x_coords) - 1):
            x1 = normalize(x_coords[i], min_x, max_x, size)
            y1 = normalize(y_coords[i], min_y, max_y, size)
            x2 = normalize(x_coords[i+1], min_x, max_x, size)
            y2 = normalize(y_coords[i+1], min_y, max_y, size)

            draw.line([(x1, y1), (x2, y2)], fill='black', width=3)

    return img

# í…ŒìŠ¤íŠ¸: ì²« ë²ˆì§¸ ì»µ ìŠ¤ì¼€ì¹˜ ë Œë”ë§
if 'cup' in all_sketches:
    test_img = render_quickdraw_sketch(all_sketches['cup'][0])
    test_img  # Colabì—ì„œ ìë™ í‘œì‹œ

# ì‹œê°í™”: ë‹¤ìš´ë¡œë“œí•œ ìŠ¤ì¼€ì¹˜ í™•ì¸
import matplotlib.pyplot as plt

def visualize_category(category, num_show=5):
    """ì¹´í…Œê³ ë¦¬ë³„ ìŠ¤ì¼€ì¹˜ ì‹œê°í™”"""
    if category not in all_sketches:
        print(f"âŒ {category}ê°€ ì—†ìŠµë‹ˆë‹¤.")
        return

    sketches = all_sketches[category]
    num_show = min(num_show, len(sketches))

    fig, axes = plt.subplots(1, num_show, figsize=(15, 3))
    if num_show == 1:
        axes = [axes]

    fig.suptitle(f'{category.upper()} - QuickDraw Sketches',
                 fontsize=16, fontweight='bold')

    for i in range(num_show):
        img = render_quickdraw_sketch(sketches[i])
        axes[i].imshow(img)
        axes[i].axis('off')
        axes[i].set_title(f'#{i+1}', fontsize=10)

    plt.tight_layout()
    plt.show()

# ê° ì¹´í…Œê³ ë¦¬ í™•ì¸
for cat in ['cup', 'toilet', 'lightning', 'knife', 'face']:
    if cat in all_sketches:
        visualize_category(cat, 5)

## 1ë‹¨ê³„ - ì»¤ìŠ¤í…€ ìŠ¤ì¼€ì¹˜
import numpy as np
from PIL import Image, ImageDraw
import random

# 1. Zigzag (ìš±ì‹ ê±°ë¦¬ëŠ” í†µì¦)
def generate_zigzag(num_waves=3, size=512):
    img = Image.new('RGB', (size, size), 'white')
    draw = ImageDraw.Draw(img)

    points = []
    for i in range(150):
        x = 50 + i * 3
        y = size // 2 + 80 * np.sin(i * num_waves * 0.08)
        points.append((x, y))

    draw.line(points, fill='black', width=4)
    return img

# 2. Prison Bars (ë‹µë‹µí•¨/ê°‘ê°‘í•¨)
def generate_prison_bars(num_bars=6, size=512):
    img = Image.new('RGB', (size, size), 'white')
    draw = ImageDraw.Draw(img)

    # ìˆ˜ì§ ì°½ì‚´
    start_x = 100
    spacing = 250 // num_bars
    for i in range(num_bars):
        x = start_x + i * spacing
        draw.line([(x, 100), (x, 400)], fill='black', width=5)

    # ìˆ˜í‰ ì—°ê²° ë°”
    draw.line([(start_x-20, 150), (start_x + (num_bars-1)*spacing + 20, 150)],
              fill='black', width=5)
    draw.line([(start_x-20, 350), (start_x + (num_bars-1)*spacing + 20, 350)],
              fill='black', width=5)

    return img

# 3. Broken Heart (ìŠ¬í””)
def generate_broken_heart(size=512):
    img = Image.new('RGB', (size, size), 'white')
    draw = ImageDraw.Draw(img)

    center = size // 2

    # ì™¼ìª½ í•˜íŠ¸ ë°˜ìª½
    draw.arc([center-120, 150, center-20, 280], 0, 180, fill='black', width=4)
    draw.line([(center-120, 215), (center-30, 380)], fill='black', width=4)

    # ì˜¤ë¥¸ìª½ í•˜íŠ¸ ë°˜ìª½
    draw.arc([center+20, 150, center+120, 280], 0, 180, fill='black', width=4)
    draw.line([(center+120, 215), (center+30, 380)], fill='black', width=4)

    # ê°€ìš´ë° ê¸ˆ (ì§€ê·¸ì¬ê·¸)
    crack_points = [
        (center-30, 200), (center-10, 240), (center+10, 280),
        (center-5, 320), (center+15, 360), (center, 380)
    ]
    draw.line(crack_points, fill='black', width=4)

    return img

# ê° ì¹´í…Œê³ ë¦¬ 10ì¥ì”© ìƒì„±
print("ğŸ¨ ì»¤ìŠ¤í…€ ìŠ¤ì¼€ì¹˜ ìƒì„± ì¤‘...\n")

# Zigzag 10ì¥
zigzag_sketches = []
for i in range(10):
    num_waves = random.randint(2, 5)
    img = generate_zigzag(num_waves)
    zigzag_sketches.append(img)
print(f"âœ… zigzag: 10ì¥")

# Prison Bars 10ì¥
prison_sketches = []
for i in range(10):
    num_bars = random.randint(5, 8)
    img = generate_prison_bars(num_bars)
    prison_sketches.append(img)
print(f"âœ… prison_bars: 10ì¥")

# Broken Heart 10ì¥
heart_sketches = []
for i in range(10):
    img = generate_broken_heart()
    heart_sketches.append(img)
print(f"âœ… broken_heart: 10ì¥")

# all_sketchesì— ì¶”ê°€
all_sketches['zigzag'] = zigzag_sketches
all_sketches['prison_bars'] = prison_sketches
all_sketches['broken_heart'] = heart_sketches

print(f"\n{'='*60}")
print(f"âœ… ì „ì²´ ë°ì´í„° ì¤€ë¹„ ì™„ë£Œ!")
print(f"   ì´ {len(all_sketches)}ê°œ ì¹´í…Œê³ ë¦¬")
print(f"   ì´ {60 + 30}ì¥ (QuickDraw 60 + ì»¤ìŠ¤í…€ 30)")
print(f"{'='*60}")

###############################################################################
# ğŸ§ª ì‹¤í—˜ 2: AAC ë³µí•© ì˜ì‚¬ì†Œí†µ - ì ì§„ì  ìš”ì†Œ ì¶”ê°€ ì‹œ êµ¬ì¡° ë³´ì¡´
###############################################################################

from PIL import Image, ImageDraw
import numpy as np
import matplotlib.pyplot as plt

print("\n" + "="*70)
print("ğŸ§ª ì‹¤í—˜ 2: AAC ë³µí•© ì˜ì‚¬ì†Œí†µ - ì ì§„ì  ìš”ì†Œ ì¶”ê°€ ì‹œ êµ¬ì¡° ë³´ì¡´")
print("="*70)
print("ëª©í‘œ: í™˜ìê°€ ìš”ì†Œë¥¼ ì¶”ê°€í•  ë•Œ ì´ì „ ìš”ì†Œê°€ ê¹¨ì§€ì§€ ì•Šê³  ìœ ì§€ë˜ëŠ”ì§€ ê²€ì¦")
print("ì‹œë‚˜ë¦¬ì˜¤: í™˜ìê°€ 'ë¬¼ ë§ˆì‹œê³  ì‹¶ë‹¤' â†’ 'ì¹¨ëŒ€ì—ì„œ' â†’ 'ë„ì™€ì£¼ì„¸ìš”'ë¡œ í™•ì¥")
print("="*70 + "\n")

# 1. ì ì§„ì  ìŠ¤ì¼€ì¹˜ ìƒì„± (ìš”ì†Œ ì¶”ê°€)
print("ğŸ¨ ì ì§„ì  ìŠ¤ì¼€ì¹˜ ìƒì„± ì¤‘...\n")

def create_stage1_cup(size=512):
    """1ë‹¨ê³„: ë¬¼ì»µë§Œ"""
    img = Image.new('L', (size, size), 255)
    draw = ImageDraw.Draw(img)

    # ì»µ (ì™¼ìª½ì— ë°°ì¹˜)
    draw.line([(100, 250), (80, 380)], fill=0, width=5)   # ì™¼ìª½
    draw.line([(200, 250), (220, 380)], fill=0, width=5)  # ì˜¤ë¥¸ìª½
    draw.line([(80, 380), (220, 380)], fill=0, width=5)   # ë°”ë‹¥
    draw.line([(100, 250), (200, 250)], fill=0, width=4)  # ìœ—ë¶€ë¶„

    # ë¬¼ í‘œì‹œ
    draw.line([(90, 320), (130, 315), (170, 320), (210, 315)], fill=0, width=3)

    return img

def create_stage2_cup_person(size=512):
    """2ë‹¨ê³„: ë¬¼ì»µ + ì‚¬ëŒ (ë¬¼ì„ ë§ˆì‹œë ¤ëŠ”)"""
    img = Image.new('L', (size, size), 255)
    draw = ImageDraw.Draw(img)

    # 1ë‹¨ê³„ì™€ ë™ì¼í•œ ì»µ (ìœ„ì¹˜ ê³ ì •!)
    draw.line([(100, 250), (80, 380)], fill=0, width=5)
    draw.line([(200, 250), (220, 380)], fill=0, width=5)
    draw.line([(80, 380), (220, 380)], fill=0, width=5)
    draw.line([(100, 250), (200, 250)], fill=0, width=4)
    draw.line([(90, 320), (130, 315), (170, 320), (210, 315)], fill=0, width=3)

    # ì‚¬ëŒ ì¶”ê°€ (ì˜¤ë¥¸ìª½)
    draw.ellipse([300, 200, 360, 260], outline=0, width=4)  # ë¨¸ë¦¬
    draw.line([(330, 260), (330, 360)], fill=0, width=5)    # ëª¸í†µ
    draw.line([(330, 290), (280, 320)], fill=0, width=4)    # ì™¼íŒ” (ì»µ ìª½ìœ¼ë¡œ)
    draw.line([(330, 290), (380, 310)], fill=0, width=4)    # ì˜¤ë¥¸íŒ”
    draw.line([(330, 360), (300, 420)], fill=0, width=4)    # ì™¼ìª½ ë‹¤ë¦¬
    draw.line([(330, 360), (360, 420)], fill=0, width=4)    # ì˜¤ë¥¸ìª½ ë‹¤ë¦¬

    return img

def create_stage3_cup_person_bed(size=512):
    """3ë‹¨ê³„: ë¬¼ì»µ + ì‚¬ëŒ + ì¹¨ëŒ€ (ì¹¨ëŒ€ì— ëˆ„ì›Œì„œ ë¬¼ í•„ìš”)"""
    img = Image.new('L', (size, size), 255)
    draw = ImageDraw.Draw(img)

    # 1ë‹¨ê³„ì™€ ë™ì¼í•œ ì»µ (ìœ„ì¹˜ ê³ ì •!)
    draw.line([(100, 250), (80, 380)], fill=0, width=5)
    draw.line([(200, 250), (220, 380)], fill=0, width=5)
    draw.line([(80, 380), (220, 380)], fill=0, width=5)
    draw.line([(100, 250), (200, 250)], fill=0, width=4)
    draw.line([(90, 320), (130, 315), (170, 320), (210, 315)], fill=0, width=3)

    # 2ë‹¨ê³„ì™€ ë™ì¼í•œ ì‚¬ëŒ (ìœ„ì¹˜ ê³ ì •!)
    draw.ellipse([300, 200, 360, 260], outline=0, width=4)
    draw.line([(330, 260), (330, 360)], fill=0, width=5)
    draw.line([(330, 290), (280, 320)], fill=0, width=4)
    draw.line([(330, 290), (380, 310)], fill=0, width=4)
    draw.line([(330, 360), (300, 420)], fill=0, width=4)
    draw.line([(330, 360), (360, 420)], fill=0, width=4)

    # ì¹¨ëŒ€ ì¶”ê°€ (í•˜ë‹¨)
    draw.rectangle([250, 400, 450, 450], outline=0, width=5)  # ì¹¨ëŒ€ í”„ë ˆì„
    draw.line([(250, 420), (450, 420)], fill=0, width=3)      # ë§¤íŠ¸ë¦¬ìŠ¤ ì„ 
    draw.line([(250, 450), (250, 480)], fill=0, width=4)      # ì™¼ìª½ ë‹¤ë¦¬
    draw.line([(450, 450), (450, 480)], fill=0, width=4)      # ì˜¤ë¥¸ìª½ ë‹¤ë¦¬

    return img

# ìŠ¤ì¼€ì¹˜ ìƒì„±
stage1 = create_stage1_cup()
stage2 = create_stage2_cup_person()
stage3 = create_stage3_cup_person_bed()

print("âœ… 1ë‹¨ê³„: ë¬¼ì»µë§Œ (ê¸°ë³¸ ìš”ì²­)")
print("âœ… 2ë‹¨ê³„: ë¬¼ì»µ + ì‚¬ëŒ (ëˆ„ê°€ ë§ˆì‹¤ì§€ ëª…í™•í™”)")
print("âœ… 3ë‹¨ê³„: ë¬¼ì»µ + ì‚¬ëŒ + ì¹¨ëŒ€ (ì–´ë””ì„œ í•„ìš”í•œì§€ ëª…í™•í™”)\n")

# 2. ControlNet ì…ë ¥ ì¤€ë¹„
print("ğŸ” ControlNet ì…ë ¥ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ ì¤‘...\n")

def prepare_control_image(sketch):
    """í‘ë°± ìŠ¤ì¼€ì¹˜ â†’ RGB ë³€í™˜"""
    sketch_array = np.array(sketch)
    control_image = np.stack([sketch_array] * 3, axis=-1)
    return Image.fromarray(control_image)

control1 = prepare_control_image(stage1)
control2 = prepare_control_image(stage2)
control3 = prepare_control_image(stage3)

print("âœ… ControlNet ì…ë ¥ ì¤€ë¹„ ì™„ë£Œ!\n")

# 3. í”„ë¡¬í”„íŠ¸ ì„¤ì • (ìŠ¤ì¼€ì¹˜ ë‚´ìš© ì„¤ëª…)
prompts = [
    "a glass of water on a table",  # 1ë‹¨ê³„
    "a glass of water with a person reaching for it",  # 2ë‹¨ê³„
    "a glass of water, a person, and a hospital bed"  # 3ë‹¨ê³„
]

# ì‹¤í—˜ íŒŒë¼ë¯¸í„°
cfg_scale = 7.0
controlnet_scale = 1.0
seed = 42
num_steps = 20

print("ğŸ“‹ ì‹¤í—˜ ì„¤ì •:")
print(f"   - ControlNet: lllyasviel/control_v11p_sd15_scribble")
print(f"   - 1ë‹¨ê³„: ë¬¼ì»µë§Œ")
print(f"   - 2ë‹¨ê³„: ë¬¼ì»µ(ìœ„ì¹˜ ê³ ì •) + ì‚¬ëŒ ì¶”ê°€")
print(f"   - 3ë‹¨ê³„: ë¬¼ì»µ(ìœ„ì¹˜ ê³ ì •) + ì‚¬ëŒ(ìœ„ì¹˜ ê³ ì •) + ì¹¨ëŒ€ ì¶”ê°€")
print(f"   - CFG Scale: {cfg_scale}")
print(f"   - ControlNet Scale: {controlnet_scale}")
print(f"   - Seed: {seed}\n")

# 4. ControlNetìœ¼ë¡œ ì´ë¯¸ì§€ ìƒì„±
print("ğŸ¨ ControlNet ì´ë¯¸ì§€ ìƒì„± ì‹œì‘...\n")

stages = [
    {'name': '1ë‹¨ê³„: ë¬¼ì»µë§Œ', 'sketch': stage1, 'control': control1, 'prompt': prompts[0]},
    {'name': '2ë‹¨ê³„: ë¬¼ì»µ + ì‚¬ëŒ', 'sketch': stage2, 'control': control2, 'prompt': prompts[1]},
    {'name': '3ë‹¨ê³„: ë¬¼ì»µ + ì‚¬ëŒ + ì¹¨ëŒ€', 'sketch': stage3, 'control': control3, 'prompt': prompts[2]}
]

experiment2_results = []

for i, stage in enumerate(stages, 1):
    print(f"[{i}/3] {stage['name']}")
    print(f"   í”„ë¡¬í”„íŠ¸: \"{stage['prompt']}\"")
    print("   ìƒì„± ì¤‘...", end=" ")

    generator = torch.manual_seed(seed)

    image = pipe(
        prompt=stage['prompt'],
        image=stage['control'],
        controlnet_conditioning_scale=controlnet_scale,
        guidance_scale=cfg_scale,
        num_inference_steps=num_steps,
        generator=generator
    ).images[0]

    stage['generated'] = image
    experiment2_results.append(stage)

    print("âœ…\n")

print("="*70)
print("âœ… ì‹¤í—˜ 2 ìƒì„± ì™„ë£Œ!")
print("="*70 + "\n")

# 5. ê²°ê³¼ ì‹œê°í™”
print("ğŸ“Š ê²°ê³¼ ì‹œê°í™” ì¤‘...\n")

fig, axes = plt.subplots(3, 3, figsize=(16, 14))

# í—¤ë”
headers = ['Patient Sketch\n(Progressive)', 'ControlNet Input', 'Generated Image\n(Check Preservation)']
for col, header in enumerate(headers):
    axes[0, col].text(0.5, 1.12, header,
                      transform=axes[0, col].transAxes,
                      ha='center', va='top',
                      fontsize=13, fontweight='bold')

# ê° ë‹¨ê³„ë³„ í–‰
for row, result in enumerate(experiment2_results):
    # ìŠ¤ì¼€ì¹˜
    axes[row, 0].imshow(result['sketch'], cmap='gray')
    axes[row, 0].set_title(result['name'], fontsize=11, pad=10, fontweight='bold')
    axes[row, 0].axis('off')

    # ControlNet ì…ë ¥
    axes[row, 1].imshow(result['control'])
    axes[row, 1].axis('off')

    # ìƒì„± ê²°ê³¼
    axes[row, 2].imshow(result['generated'])
    axes[row, 2].axis('off')

plt.suptitle('ğŸ§ª ì‹¤í—˜ 2: AAC ë³µí•© ì˜ì‚¬ì†Œí†µ - ì ì§„ì  ìš”ì†Œ ì¶”ê°€ ì‹œ êµ¬ì¡° ë³´ì¡´\n' +
             f'(CFG={cfg_scale}, ControlNet Scale={controlnet_scale}, Seed={seed})',
             fontsize=14, fontweight='bold', y=0.98)
plt.tight_layout()
plt.savefig('/content/experiment2_progressive_communication.png', dpi=150, bbox_inches='tight')
plt.show()

print("âœ… ì‹œê°í™” ì™„ë£Œ!")

# 6. í‰ê°€ ì•ˆë‚´
print("\n" + "="*70)
print("ğŸ“‹ ControlNet êµ¬ì¡° ë³´ì¡´ í‰ê°€ (í•µì‹¬!)")
print("="*70)
print("1ï¸âƒ£ ë¬¼ì»µ ìœ„ì¹˜ ë³´ì¡´:")
print("   â†’ 1ë‹¨ê³„ì—ì„œ ê·¸ë¦° ë¬¼ì»µì´ 2ë‹¨ê³„, 3ë‹¨ê³„ì—ì„œë„ ê°™ì€ ìœ„ì¹˜ì— ìˆë‚˜ìš”?")
print("   â†’ ì‚¬ëŒì´ë‚˜ ì¹¨ëŒ€ê°€ ì¶”ê°€ë˜ì–´ë„ ë¬¼ì»µì´ ì‚¬ë¼ì§€ê±°ë‚˜ ì´ë™í•˜ì§€ ì•Šë‚˜ìš”?")
print()
print("2ï¸âƒ£ ì‚¬ëŒ ìœ„ì¹˜ ë³´ì¡´:")
print("   â†’ 2ë‹¨ê³„ì—ì„œ ì¶”ê°€ëœ ì‚¬ëŒì´ 3ë‹¨ê³„ì—ì„œë„ ê°™ì€ ìœ„ì¹˜/ìì„¸ì¸ê°€ìš”?")
print("   â†’ ì¹¨ëŒ€ê°€ ì¶”ê°€ë˜ì–´ë„ ì‚¬ëŒì˜ í˜•íƒœê°€ ìœ ì§€ë˜ë‚˜ìš”?")
print()
print("3ï¸âƒ£ ì ì§„ì  ì •ë³´ ì¶”ê°€:")
print("   â†’ ê° ë‹¨ê³„ê°€ 'ì¶”ê°€'ì²˜ëŸ¼ ë³´ì´ë‚˜ìš”, ì•„ë‹ˆë©´ 'ì™„ì „íˆ ë‹¤ë¥¸ ì´ë¯¸ì§€'ì¸ê°€ìš”?")
print("   â†’ 1ë‹¨ê³„ â†’ 2ë‹¨ê³„ â†’ 3ë‹¨ê³„ë¡œ 'ì§„í™”'í•˜ëŠ” ëŠë‚Œì´ ìˆë‚˜ìš”?")
print()
print("4ï¸âƒ£ ControlNetì˜ ì—­í• :")
print("   âœ“ Without ControlNet:")
print("      â†’ í”„ë¡¬í”„íŠ¸ë§Œìœ¼ë¡œ ìƒì„± â†’ ë§¤ë²ˆ ëœë¤í•œ ìœ„ì¹˜/êµ¬ë„")
print("      â†’ í™˜ìê°€ 'ì¶”ê°€'ë¥¼ ì˜ë„í•´ë„ ì‹œìŠ¤í…œì€ 'ìƒˆ ì´ë¯¸ì§€' ìƒì„±")
print("   âœ“ With ControlNet:")
print("      â†’ ìŠ¤ì¼€ì¹˜ êµ¬ì¡°ë¥¼ ê°•ì œë¡œ ë”°ë¼ê°")
print("      â†’ ì´ì „ ìš”ì†Œ(ì»µ)ì˜ ìœ„ì¹˜ë¥¼ ìœ ì§€í•œ ì±„ ìƒˆ ìš”ì†Œ(ì‚¬ëŒ, ì¹¨ëŒ€) ì¶”ê°€")
print("      â†’ í™˜ìì˜ 'ì ì§„ì  ì˜ì‚¬ì†Œí†µ' ì˜ë„ê°€ ì •í™•íˆ ì „ë‹¬ë¨!")
print()
print("5ï¸âƒ£ AAC ì‹¤ìš©ì„±:")
print("   â†’ í™˜ì: 'ë¬¼' ê·¸ë¦¼ â†’ ì ê¹, 'ëˆ„ê°€ ë§ˆì‹¤ì§€' ì¶”ê°€ â†’ 'ì–´ë””ì„œ' ì¶”ê°€")
print("   â†’ ì‹œìŠ¤í…œ: ê° ë‹¨ê³„ë§ˆë‹¤ ì´ì „ ì •ë³´ë¥¼ ìœ ì§€í•˜ë©° ì—…ë°ì´íŠ¸")
print("   â†’ ì˜ë£Œì§„: í™˜ìì˜ ì˜ë„ë¥¼ ì ì§„ì ìœ¼ë¡œ ì •í™•íˆ íŒŒì•… ê°€ëŠ¥")
print("="*70)

# 7. ê°œë³„ ì´ë¯¸ì§€ ì €ì¥
print("\nğŸ’¾ ê°œë³„ ì´ë¯¸ì§€ ì €ì¥ ì¤‘...")
for i, result in enumerate(experiment2_results, 1):
    filename = f"/content/exp2_stage{i}_generated.png"
    result['generated'].save(filename)
    print(f"   âœ“ ë‹¨ê³„ {i}: {filename}")

print("\nğŸ’¾ ì €ì¥ ìœ„ì¹˜:")
print("   - ì „ì²´ ë¹„êµ: /content/experiment2_progressive_communication.png")

print("\nğŸ‰ ì‹¤í—˜ 2 ì™„ë£Œ!")
print("\n" + "="*70)
print("ğŸ’¡ ì‹¤í—˜ í•µì‹¬ ì§ˆë¬¸:")
print("   Q1. 2ë‹¨ê³„ ì´ë¯¸ì§€ì—ì„œ 1ë‹¨ê³„ì˜ 'ë¬¼ì»µ'ì´ ë³´ì¡´ë˜ì—ˆë‚˜ìš”?")
print("   Q2. 3ë‹¨ê³„ ì´ë¯¸ì§€ì—ì„œ 1ë‹¨ê³„ì˜ 'ë¬¼ì»µ' + 2ë‹¨ê³„ì˜ 'ì‚¬ëŒ'ì´ ë³´ì¡´ë˜ì—ˆë‚˜ìš”?")
print("   Q3. ControlNetì´ 'ì ì§„ì  ì˜ì‚¬ì†Œí†µ'ì„ ê°€ëŠ¥í•˜ê²Œ í–ˆë‚˜ìš”?")
print("\n   â†’ ë§Œì•½ ë³´ì¡´ë˜ì—ˆë‹¤ë©´: AACì—ì„œ ControlNet ì‚¬ìš© ê°€ì¹˜ ì…ì¦! âœ…")
print("   â†’ ë§Œì•½ ê¹¨ì¡Œë‹¤ë©´: ControlNet Scale ì¡°ì • ë˜ëŠ” ë‹¤ë¥¸ ì „ëµ í•„ìš”")
print("="*70)